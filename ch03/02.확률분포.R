# ë² ë¥´ëˆ„ì´ ì‹œí–‰(ë™ì‹œì— ì¼ì–´ë‚ ìˆ˜ì—†ëŠ”ì‚¬ê±´/ë…ë¦½ì ì¸ ì‚¬ê±´)
# nì€ ì‹œí–‰íšŸìˆ˜ pëŠ” ê° ì‹œí–‰ì—ì„œ ì„±ê³µí•  í™•ë¥ 
# ğµ(ğ‘›, ğ‘) : í™•ë¥ ë³€ìˆ˜ Xê°€ ì´í•­ë¶„í¬ë¥¼ ë”°ë¥¼ ë•Œ ğ‘‹ ~ ğµ(ğ‘›, ğ‘)
# ê¸°ëŒ€ê°’ E(X) np
# ë¶„ì‚°ì€ npq (q=1-p)  np(1-p)


# Q.í™•ë¥ ë³€ìˆ˜ Xê°€ ì‹œí–‰ì˜ íšŸìˆ˜ê°€ 6ì´ê³  ì„±ê³µì˜ í™•ë¥ ì´ 1/3ì¸ ì´í•­ë¶„í¬ë¥¼ ë”°ë¥¼ ë•Œ 
#Rì´ ë‚´ì¥í•˜ê³  ìˆëŠ” ì´í•­ë¶„í¬ì™€ ê´€ë ¨ëœ í•¨ìˆ˜ë¥¼ ì´ìš©í•˜ì—¬ ê°ì¢… í™•ë¥ ì„ ê³„ì‚°í•´ ë´…ì‹œë‹¤.

#### í™•ë¥ ë¶„í¬
### ì´í•­ë¶„í¬ binomial distribution
n = 6
p = 1/3
x = 0:n     # B(6, 1/3)

# í™•ë¥  ì§ˆëŸ‰í•¨ìˆ˜ nCx p^x (1-p)^(n-x)
# nCx p^x (1-p)^(6-x)
dbinom(2, n, p)     # 6C2 (1/3)^2 (1-(1/3))^(6-2) => 0.3292181
dbinom(x=4, size=n, prob=p)
# x : ì´í•­ë¶„í¬ì˜ ì„±ê³µì˜ íšŸìˆ˜ì˜ ë²¡í„°(ì›ì†Œ 1ê°œì§œë¦¬ í¬í•¨)
# size : ì‹œí–‰ì˜ íšŸìˆ˜
# prob : ì„±ê³µì˜ í™•ë¥ 
px = dbinom(x, n, p)
px # 0.087791495 0.263374486 0.329218107 0.219478738 0.082304527 0.016460905 0.001371742
plot(x, px, type='s', xlab='ì„±ê³µ íšŸìˆ˜', ylab='í™•ë¥ (P[X=x])', main='B(6, 1/3)')
plot(x, px, type='h', xlab='ì„±ê³µ íšŸìˆ˜', ylab='í™•ë¥ (P[X=x])', main='B(6, 1/3)',
     lwd=20, col='red')

# ëˆ„ì  ë¶„í¬í•¨ìˆ˜
pbinom(2, n, p)     # dbinom(0,n,p) + dbinom(1,n,p) + dbinom(2,n,p)  0.6803841
# ì„±ê³µíšŸìˆ˜ê°€ 1~3 ì¸ í™•ë¥ 
dbinom(1,n,p) + dbinom(2,n,p) + dbinom(3,n,p) # 0.8120713
pbinom(3,n,p) - pbinom(0,n,p)   # 0.8120713

# ë¶„ìœ„ qì— í•´ë‹¹í•˜ëŠ” ê°’ì„ ì°¾ì•„ì£¼ëŠ” í•¨ìˆ˜
# ëˆ„ì í™•ë¥  ê°’ì´ pê°€ ë  ë•Œì˜ xê°’ì„ ì°¾ì•„ì£¼ëŠ” í•¨ìˆ˜
# xê°’ì´ 0.1ì¼ë•Œ  ê·¸ë˜í”„ë´ë°”ë¼ xì¶•ì´ 1ì¼ë•Œ 0.1ì„ ë„˜ìœ¼ë‹ˆê¹Œ.......
qbinom(p=0.1, n, p)   # 1
qbinom(p=0.5, n, p)   # 2

# ì´í•­ë¶„í¬ë¥¼ ë”°ë¥´ëŠ” ëª¨ì§‘ë‹¨ìœ¼ë¡œë¶€í„° nê°œì˜ í‘œë³¸ ì¶”ì¶œ
rbinom(10, n, p) # randomê°’

set.seed(2023) # seedê°’ìœ¼ë¡œ randomê°’ ê³ ì •
rbinom(10, n, p)

# ê¸°ëŒ€ê°’ê³¼ ë¶„ì‚°
n = 6
p = 1/3
x = 0:n     # B(6, 1/3)
px = dbinom(x, n, p)
ex = sum(x * px)    # Expectation value ê¸°ëŒ€ê°’ 2
ex
# ë¶„ì‚°ì„ êµ¬í•˜ê¸°ìœ„í•´ ì œê³±
ex2 = sum(x^2 * px)
ex2
varx = ex2 - ex^2   # Variation ë³€ë™
varx

### ì •ê·œë¶„í¬
# ì–´ëŠ ëŒ€í•™êµ ë‚¨í•™ìƒ í‚¤ì˜ í‰ê· ì€ 170cm, í‘œì¤€í¸ì°¨ëŠ” 6ì¸ ì •ê·œë¶„í¬ë¥¼ ë”°ë¥¸ë‹¤.
# 180cmë³´ë‹¤ í° í•™ìƒì˜ í™•ë¥ ì€?
options(digits=4)
mu = 170
sigma = 6   # ì—¬ê¸°ì„œ ì‹œê·¸ë§ˆëŠ” í‘œì¤€í¸ì°¨ì¸ê°€
ll = mu - 3 * sigma     # lower limit
ul = mu + 3 * sigma     # upper limit
x = seq(ll, ul, by=0.01)
px = dnorm(x, mean=mu, sd=sigma)
plot(x, px, type='l', xlab='ë‚¨í•™ìƒì˜ í‚¤(x)', ylab='P[X=x]',
     lwd=2, col='green', main='N(170, 6^2)')
# ì ˆëŒ€ë¡œ 0ì— ë‹¿ì§€ ì•ŠìŒ

prob = pnorm(180, 170, 6) # 0.9522
print(paste('180cmë³´ë‹¤ í° í•™ìƒì˜ í™•ë¥ ì€', 1-prob, 'ì…ë‹ˆë‹¤.'))

# ìƒìœ„ 10%ì— ì†í•˜ë ¤ë©´ í‚¤ê°€ ì–¼ë§ˆì´ì–´ì•¼ í•˜ëŠ”ê°€?
height = qnorm(0.9, 170, 6)     # 177.7
height

# í‚¤ê°€ 165cm ~ 175cmì¼ í™•ë¥ 
pnorm(175, 170, 6) - pnorm(165, 170, 6) # 0.5953

# 95% ì— ì†í•˜ëŠ” í•™ìƒë“¤ì˜ í‚¤ ë²”ìœ„ëŠ”?
# q(0.025) q(0.975)
ll = qnorm(0.025, 170, 6)
ul = qnorm(0.975, 170, 6)
print(paste(ll, '~', ul, '(cm)'))   # 158.24021609276 ~ 181.75978390724 (cm)

# 400ê°œì˜ ë‚œìˆ˜ë¥¼ ìƒì„±í•˜ì—¬ ëª¨ì§‘ë‹¨ê³¼ ë¹„êµ
set.seed(2023)
smp = rnorm(200, 170, 6) # mean=170, sd=6
print(paste(mean(smp), sd(smp)))
hist(smp, prob=T, main='N(170, 6^2)ìœ¼ë¡œë¶€í„° ì¶”ì¶œí•œ í‘œë³¸ì˜ ë¶„í¬(n=400',
     xlab='', ylab='', col='white', border='black')
lines(x, px, lty=2, col='red') # x,px ìœ„ì— ê°’ ìˆìŒ.
# ltyëŠ” ì ì„  

## ì •ê·œë¶„í¬ì˜ íŠ¹ì§•
mu = 0
sigma = 1
# p0.05 = qnorm(0.05)     # qnorm(0.95) ì™€ ë¶€í˜¸ê°€ ë°˜ëŒ€ì¸ ê°’ -1.645
p0.05 = qnorm(0.95)     # qnorm(0.05) ì™€ ë¶€í˜¸ê°€ ë°˜ëŒ€ì¸ ê°’ 1.645
p0.05   # 90% ì‹ ë¢°ìˆ˜ì¤€ 1.645
p0.025 = qnorm(0.975)
p0.025  # 95% ì‹ ë¢°ìˆ˜ì¤€ 1.96

pnorm(1.96) - pnorm(-1.96) # 0.95
qnorm(0.995) # 99% ì‹ ë¢°ìˆ˜ì¤€ 2.576  ì–˜ëŠ” Që†ˆ ì‹ ë¢°ìˆ˜ì¤€ì€ íë†ˆ
pnorm(2.576) - pnorm(-2.576) # 0.99

# 95% ì‹ ë¢°êµ¬ê°„
z <- seq(-3, 3, by=0.001)
z.p <- dnorm(z)
plot(z, z.p, axes=F, type="l", 
     main="í‘œì¤€ì •ê·œë¶„í¬ (95%)", ylab="", ylim=c(-0.04, 0.4))
axis(1)

lines(c(-3, 3), c(0, 0))
points(-1.96, -0.02, pch=17, col="red")
text(-1.96, -0.035, "-1.96", col="red")
points(1.96, -0.02, pch=17, col="red")
text(1.96, -0.035, "1.96", col="red")

s <- seq(-1.96, 1.96, by=0.001)
s.z <- dnorm(s, mean=0, sd=1)
s <- c(-1.96, s, 1.96)
s.z <- c(0, s.z, 0)
polygon(s, s.z, col="red", density=10, angle=305)


# 90% ì‹ ë¢°êµ¬ê°„
qnorm(0.9) # 1.282
pnorm(1.282) - pnorm(-1.282)
